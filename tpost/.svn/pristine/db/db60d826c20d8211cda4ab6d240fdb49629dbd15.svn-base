<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport"
        content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>코드관리</title>

    <!-- CSS  STYLE -->
	<link rel="stylesheet" href="/tpost/resource/css/common.css">
	<!-- ---------- -->
	<style>
        td > input, td > select {box-sizing: border-box; width:100%}
        .table-pnl{margin-top: 15px !important;}
        .layerBox .layer {width:430px; height:470px;}
        .layerBox .table-pnl {margin:15px}
        .layer .footer {position: absolute; bottom: 28px; left: 50%; width:100%; transform: translate(-50%, 0);}
    </style>
	<!--     JS     -->
	<script src="/tpost/resource/js/jquery.min.js"></script>
	<script src="/tpost/resource/js/jquery-migrate-1.2.1.min.js"></script>
	<script src="/tpost/resource/js/jquery-ui.min.js"></script>
	<script src="/tpost/resource/js/comm.js"></script>
	<!-- ---------- -->
    <script type="text/javascript">
	    function enterSerch(){
	    	if(window.event.keyCode == 13){
	    		codeMgntSelect();
	    	}
	    }
    	
		//상단 조회 버튼 클릭 시
		function codeMgntSelect(){
	  		var codeMgntForm = document.getElementById("codeMgnt");
	  		codeMgntForm.action = "codeMgntSelect";
	  		codeMgntForm.method = "post";
	  		codeMgntForm.submit();
		}
		
		//분류코드명 클릭 시 기본코드 조회
		function cfcdToBascSelect(cfcd){
			var parameters = "inputCfcd="+ cfcd;

			$.ajax({
				type : "post",
				dataType : "json",
				async : false,
				url : "cfcdToBascSelect.ajax",
				data : parameters,
				success : function(data) {
					$("#bascTable").html(''); //테이블 초기화
					$("#dtcdTable").html(''); //테이블 초기화
					if(data.bascList.length != 0){
						var bascTableTr ="";
						for(var i = 0; i < data.bascList.length; i++){
							var bascList = data.bascList[i];

							bascTableTr += '<tr>';
							bascTableTr += '<td class="text-c" onclick="goCodeBascPopu(1, '+ bascList.detlPk +')">' + bascList.basc + '</td>';
							bascTableTr += '<td onclick="bascToDtcdSelect(' + bascList.detlPk +')">' + bascList.bascNm + '</td>';
							bascTableTr += '</tr>';	
						}
						bascSelect(data.bascList[0].detlPk);
					}
					
					if(data.dtcdList.length != 0){
						var dtcdTableTr ="";
						for(var i = 0; i < data.dtcdList.length; i++){
							var dtcdList = data.dtcdList[i];
							
							dtcdTableTr += '<tr>';
							dtcdTableTr += '<td class="text-c" onclick="goCodeDetlPopu(1, '+ dtcdList.detlPk +')">' + dtcdList.dtcd + '</td>';
							dtcdTableTr += '<td onclick="dtcdSelect(' + dtcdList.detlPk + ')">' + dtcdList.dtcdNm + '</td>';
							dtcdTableTr += '</tr>';	
						}
						dtcdSelect(data.dtcdList[0].detlPk);
					}
					
					$("#bascTable").append(bascTableTr);
					$("#dtcdTable").append(dtcdTableTr);
					
					if(data.bascList.length == 0 && data.dtcdList.length == 0){
						cfcdSelect(cfcd);
					}
				},
				complete : function(data) {
				}
			});
		}

		//기본코드명 클릭 시 세부코드 조회
		function bascToDtcdSelect(detlPk){	
			var parameters = "detlPk="+ detlPk;

			$.ajax({
				type : "post",
				dataType : "json",
				async : false,
				url : "bascToDtcdSelect.ajax",
				data : parameters,
				success : function(data) {
					$("#dtcdTable").html(''); //테이블 초기화
					if(data.dtcdList.length != 0){
						var dtcdTableTr ="";
						for(var i = 0; i < data.dtcdList.length; i++){
							var dtcdList = data.dtcdList[i];
							
							dtcdTableTr += '<tr>';
							dtcdTableTr += '<td class="text-c" onclick="goCodeDetlPopu(1, '+ dtcdList.detlPk +')">' + dtcdList.dtcd + '</td>';
							dtcdTableTr += '<td onclick="dtcdSelect(' + dtcdList.detlPk + ')">' + dtcdList.dtcdNm + '</td>';
							dtcdTableTr += '</tr>';	
						}
						dtcdSelect(data.dtcdList[0].detlPk);
					}
					$("#dtcdTable").append(dtcdTableTr);
					
					if(data.dtcdList.length == 0){
						bascSelect(detlPk);
					}
				},
				complete : function(data) {
				}
			});
			
		}
		
		//븐류코드명 클릭 시 하단 상세정보 조회
		function cfcdSelect(cfcd){
			var parameters = "inputCfcd="+ cfcd;
			
			$.ajax({
				type : "post",
				dataType : "json",
				async : false,
				url : "cfcdSelect.ajax",
				data : parameters,
				success : function(data) {
					setDetailInfo(data, 0);
				},
				complete : function(data) {
				}
			});
		}

		//기본코드명 클릭 시 하단 상세정보 조회
		function bascSelect(detlPk){
			var parameters = "detlPk="+ detlPk;
			
			$.ajax({
				type : "post",
				dataType : "json",
				async : false,
				url : "bascSelect.ajax",
				data : parameters,
				success : function(data) {
					setDetailInfo(data, 1);
				},
				complete : function(data) {
				}
			});
		}

		//상세코드명 클릭 시 하단 상세정보 조회
		function dtcdSelect(detlPk){
		var parameters = "detlPk="+ detlPk;
			
			$.ajax({
				type : "post",
				dataType : "json",
				async : false,
				url : "dtcdSelect.ajax",
				data : parameters,
				success : function(data) {
					setDetailInfo(data, 2);
				},
				complete : function(data) {
				}
			});
		}
		
		//상세정보 출력
		function setDetailInfo(data, val){
			$("#detlCfcd").html(''); //테이블 초기화
			$("#detlBasc").html(''); //테이블 초기화
			$("#detlDtcd").html(''); //테이블 초기화
			if(data.detailInfo.length != 0){
				var detailInfoTr ="";
				var detailInfo = data.detailInfo[0];
				detailInfoTr += '<tr>';
				detailInfoTr += '<th>분류코드</th>';
				detailInfoTr += '<td>' + detailInfo.cfcd + '</td>';
				detailInfoTr += '<th>분류코드명</th>';
				detailInfoTr += '<td>' + detailInfo.cfcdNm + '</td>';
				detailInfoTr += '<th>분류코드설명</th>';
				detailInfoTr += '<td>' + detailInfo.cfcdDesc + '</td>';
				detailInfoTr += '</tr>';	
				$("#detlCfcd").append(detailInfoTr);

				if(val == 0) detailInfo.cfcd = "";
			
				detailInfoTr ="";
				detailInfoTr += '<tr>';
				detailInfoTr += '<th>기본코드</th>';
				detailInfoTr += '<td>' + detailInfo.basc + '</td>';
				detailInfoTr += '<th>기본코드명</th>';
				detailInfoTr += '<td>' + detailInfo.bascNm + '</td>';
				detailInfoTr += '<th>상위분류코드</th>';
				detailInfoTr += '<td>' + detailInfo.cfcd + '</td>';
				detailInfoTr += '</tr>';	
				detailInfoTr += '<tr>';
				detailInfoTr += '<th>적용시작일자</th>';
				detailInfoTr += '<td>' + detailInfo.bascApplStDt + '</td>';
				detailInfoTr += '<th>적용종료일자</th>';
				detailInfoTr += '<td>' + detailInfo.bascApplClosDt + '</td>';
				detailInfoTr += '<th>현재사용여부</th>';
				detailInfoTr += '<td>' + detailInfo.bascLstHistYn + '</td>';
				detailInfoTr += '</tr>';	
				detailInfoTr += '<tr>';
				detailInfoTr += '<th>기본코드설명</th>';
				detailInfoTr += '<td colspan = "5">' + detailInfo.bascDesc + '</td>';
				detailInfoTr += '</tr>';	
				$("#detlBasc").append(detailInfoTr);
				
				if(val == 1) detailInfo.cfcd = "";
				
				detailInfoTr ="";
				detailInfoTr += '<tr>';
				detailInfoTr += '<th>상세코드</th>';
				detailInfoTr += '<td>' + detailInfo.dtcd + '</td>';
				detailInfoTr += '<th>상세코드명</th>';
				detailInfoTr += '<td>' + detailInfo.dtcdNm + '</td>';
				detailInfoTr += '<th>상위분류코드</th>';
				detailInfoTr += '<td>' + detailInfo.cfcd + '</td>';
				detailInfoTr += '</tr>';	
				detailInfoTr += '<tr>';
				detailInfoTr += '<th>적용시작일자</th>';
				detailInfoTr += '<td>' + detailInfo.dtcdApplStDt + '</td>';
				detailInfoTr += '<th>적용종료일자</th>';
				detailInfoTr += '<td>' + detailInfo.dtcdApplClosDt + '</td>';
				detailInfoTr += '<th>현재사용여부</th>';
				detailInfoTr += '<td>' + detailInfo.dtcdLstHistYn + '</td>';
				detailInfoTr += '</tr>';	
				detailInfoTr += '<tr>';
				detailInfoTr += '<th>상세코드설명</th>';
				detailInfoTr += '<td colspan = "5">' + detailInfo.dtcdDesc + '</td>';
				detailInfoTr += '</tr>';	
				$("#detlDtcd").append(detailInfoTr);
			}
		}
		
    	//팝업 닫기
        function closePopu(){
        	jQuery(".layerBox").hide();
        	$("#detlPk").val('');
        }
        
		//codeClfPopu(분류코드 등록/수정) 팝업 오픈
		//popKnd => 0 : 등록 / 1 : 수정
		function goCodeClfPopu(popKnd, cfcd){
			jQuery("#popup1").show();
			
			var parameters = "popKnd=" + popKnd + "&inputCfcd=" + cfcd;
			
			$.ajax({
				type : "post",
				dataType : "json",
				async : false,
				url : "goCodeClfPopu.ajax",
				data : parameters,
				success : function(data) {
					$("#popup1 .topBox").html("");
					$("#popup1 .buttonset").html("");
					$("#popup1 #popuCfcd").html("");
					
					if(popKnd == "0"){
						var inner = '';
						inner += '<h3>분류코드 등록</h3>';
						inner += '<a class="close" href="#" onclick="closePopu()">&#10005;</a>';
						$('#popup1 .topBox').append(inner);
						
						inner = "";
						inner += '<button type="button" class="state-highlight" onclick="cfcdInsert()">저장</button>';
						inner += '<button type="button" class="close" onclick="closePopu()">닫기</button>';
						$("#popup1 .buttonset").append(inner);
						
						inner = "";
						inner += '<tr>';
						inner += '<th>분류코드<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" class="width100" id="cfcd" name="cfcd"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>분류코드명<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" class="width100" id="cfcdNm" name="cfcdNm"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>분류코드 설명</th>';
						inner += '<td><input type="text" class="width100" id="cfcdDesc" name="cfcdDesc"></td>';
						inner += '</tr>';
						$("#popup1 #popuCfcd").append(inner);
					}
					
					if(popKnd == "1"){
						var inner = '';
						inner += '<h3>분류코드 수정</h3>';
						inner += '<a class="close" href="#" onclick="closePopu()">&#10005;</a>';
						$('#popup1 .topBox').append(inner);
						
						inner = "";
						inner += '<button type="button" class="close" onclick="closePopu()">닫기</button>';
						$("#popup1 .buttonset").append(inner);
						
						inner = "";
						inner += '<tr>';
						inner += '<th>분류코드<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" class="width100" value="' + data.popuInfo.cfcd + '" id="cfcd" name="cfcd" readonly></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>분류코드명<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" class="width100" value="' + data.popuInfo.cfcdNm + '" id="cfcdNm" name="cfcdNm"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>분류코드 설명</th>';
						inner += '<td><input type="text" class="width100" value="' + data.popuInfo.cfcdDesc + '" id="cfcdDesc" name="cfcdDesc"></td>';
						inner += '</tr>';
						$("#popup1 #popuCfcd").append(inner);
					}
				},complete : function(data) {
					
				}
			});
		}
		
		//분류코드 등록
		function cfcdInsert(){
			if(reqValCheck('cfcd', '분류코드')) return;
			if(reqValCheck('cfcdNm', '분류코드명')) return;
		
			var parameters = { 
					cfcd		: $('#cfcd').val(),
					cfcdNm		: $('#cfcdNm').val(),
					cfcdDesc	: $('#cfcdDesc').val()
				};
			
			$.ajax({
				type : "post",
				dataType : "json",
				async : false,
				url : "cfcdInsert.ajax",
				data : parameters,
				success : function(data) {
					alert("저장되었습니다.");
					closePopu();
					codeMgntSelect();
				},
				complete : function(data) {
				}
			});
		}
		
		//codeBascPopu(기본코드 등록/수정) 팝업 오픈
		//popKnd => 0 : 등록 / 1 : 수정
		function goCodeBascPopu(popKnd, detlPk){
			jQuery("#popup2").show();
			
			$("#detlPk").val(detlPk);
			
			var cfcd = $("#detlCfcd tr").children().eq(1).text();
			var parameters = "popKnd=" + popKnd + "&detlPk=" + detlPk + "&cfcd=" + cfcd;
			
			$.ajax({
				type : "post",
				dataType : "json",
				async : false,
				url : "goCodeBascPopu.ajax",
				data : parameters,
				success : function(data) {
					$("#popup2 .topBox").html("");
					$("#popup2 .buttonset").html("");
					$("#popup2 #popuBasc").html("");
					
					if(popKnd == "0"){
						var inner = '';
						inner += '<h3>기본코드 등록</h3>';
						inner += '<a class="close" href="#" onclick="closePopu()">&#10005;</a>';
						$('#popup2 .topBox').append(inner);
						
						inner = "";
						inner += '<button type="button" class="state-highlight" onclick="bascInsert()">저장</button>';
						inner += '<button type="button" class="close" onclick="closePopu()">닫기</button>';
						$("#popup2 .buttonset").append(inner);
						
						inner = "";
						inner += '<tr>';
						inner += '<th>기본코드<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" class="width100" id="basc" name="basc"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>기본코드명<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" class="width100" id="bascNm" name="bascNm"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>기본코드 설명</th>';
						inner += '<td><input type="text" class="width100" id="bascDesc" name="bascDesc"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>적용시작일자<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" size="13" class="dateinput" id="bascApplStDt" name="bascApplStDt" onkeypress="dateFormat(this)" onkeypress="dateFormat(this)"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>적용종료일자<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" size="13" class="dateinput" id="bascApplClosDt" name="bascApplClosDt" onkeypress="dateFormat(this)" onkeypress="dateFormat(this)"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>사용여부<span style="color: #fea338;">*</span></th>';
						inner += '<td>';
						inner += '<select id="bascLstHistYn" name="bascLstHistYn" class="width25">';
						inner += '<option value="Y" selected="true">Y</option>';
						inner += '<option value="N">N</option>';
						inner += '</select>';
						inner += '</td>';
						inner += '</tr>';
						$("#popup2 #popuBasc").append(inner);
						
						getToday('bascApplStDt');
						$('#bascApplClosDt').val('9999-12-31');
					}
					
					if(popKnd == "1"){
						var inner = '';
						inner += '<h3>기본코드 수정</h3>';
						inner += '<a class="close" href="#" onclick="closePopu()">&#10005;</a>';
						$('#popup2 .topBox').append(inner);
						
						inner = "";
						inner += '<button type="button" class="state-highlight" onclick="bascUpdate()">수정</button>';
						inner += '<button type="button" class="close" onclick="closePopu()">닫기</button>';
						$("#popup2 .buttonset").append(inner);
						
						inner = "";
						inner += '<tr>';
						inner += '<th>기본코드<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" class="width100" id="basc" name="basc" value="' + data.popuInfo.basc + '" readonly></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>기본코드명<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" class="width100" id="bascNm" name="bascNm" value="' + data.popuInfo.bascNm + '"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>기본코드 설명</th>';
						inner += '<td><input type="text" class="width100" id="bascDesc" name="bascDesc" value="' + data.popuInfo.bascDesc + '"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>적용시작일자<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" size="13" class="dateinput" id="bascApplStDt" name="bascApplStDt" value="' + data.popuInfo.bascApplStDt + '" onkeypress="dateFormat(this)"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>적용종료일자<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" size="13" class="dateinput" id="bascApplClosDt" name="bascApplClosDt" value="' + data.popuInfo.bascApplClosDt + '" onkeypress="dateFormat(this)"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>사용여부<span style="color: #fea338;">*</span></th>';
						inner += '<td>';
						inner += '<select id="bascLstHistYn" name="bascLstHistYn" class="width25">';
						if(data.popuInfo.bascLstHistYn == "Y"){
							inner += '<option value="Y" selected="true">Y</option>';
							inner += '<option value="N">N</option>';			
						} else{
							inner += '<option value="Y">Y</option>';
							inner += '<option value="N" selected="true">N</option>';
						}
						inner += '</select>';
						inner += '</td>';
						inner += '</tr>';
						$("#popup2 #popuBasc").append(inner);
					}
				},complete : function(data) {
					datepicker();
				}
			});	
		}
		
		//기본코드 등록
		function bascInsert(){
			if(reqValCheck('basc', '기본코드')) return;
			if(reqValCheck('bascNm', '기본코드명')) return;
			
			var cfcd = $("#detlCfcd tr").children().eq(1).text();
			
			var parameters = { 
					cfcd			: cfcd,
					basc			: $('#basc').val(),
					bascNm			: $('#bascNm').val(),
					bascDesc		: $('#bascDesc').val(),
					bascApplStDt	: $('#bascApplStDt').val(),
					bascApplClosDt 	: $('#bascApplClosDt').val(),
					bascLstHistYn 	: $('#bascLstHistYn').val(),
				};
			
			$.ajax({
				type : "post",
				dataType : "json",
				async : false,
				url : "bascInsert.ajax",
				data : parameters,
				success : function(data) {
					alert("저장되었습니다.");
					closePopu();
					
					codeMgntSelect();
				},
				complete : function(data) {
				}
			});
		}
		
		//기본코드 수정 => 적용종료일자 : 현재일자 -1 / 현재사용여부 : N
		function bascUpdate(){	
			if(reqValCheck('basc', '기본코드')) return;
			if(reqValCheck('bascNm', '기본코드명')) return;
			
			var cfcd = $("#detlCfcd tr").children().eq(1).text();
			
			var parameters = { 
					detlPk			: $('#detlPk').val(),
					cfcd			: cfcd,
					basc			: $('#basc').val(),
					bascNm			: $('#bascNm').val(),
					bascDesc		: $('#bascDesc').val(),
					bascApplStDt	: $('#bascApplStDt').val(),
					bascApplClosDt 	: $('#bascApplClosDt').val(),
					bascLstHistYn 	: $('#bascLstHistYn').val(),
				};
			
			$.ajax({
				type : "post",
				dataType : "json",
				async : false,
				url : "bascUpdate.ajax",
				data : parameters,
				success : function(data) {
					alert("수정되었습니다.");
					closePopu();
					
					codeMgntSelect();
				},
				complete : function(data) {
				}
			});
		}
		
		//codeDetlPopu(상세코드 등록/수정) 팝업 오픈
		//popKnd => 0 : 등록 / 1 : 수정
		function goCodeDetlPopu(popKnd, detlPk){
			jQuery("#popup3").show();
			
			$("#detlPk").val(detlPk);
			
			var cfcd = $("#detlBasc tr").children().eq(5).text();
			
			var basc = $("#detlBasc tr").children().eq(1).text();
			var bascNm = $("#detlBasc tr").children().eq(3).text();
			var bascDesc = $("#detlBasc tr").children().eq(13).text();
			var bascApplStDt = $("#detlBasc tr").children().eq(7).text();
			var bascApplClosDt = $("#detlBasc tr").children().eq(9).text();
			var bascLstHistYn = $("#detlBasc tr").children().eq(11).text();
			
			var parameters = "popKnd=" + popKnd + "&detlPk=" + detlPk + "&cfcd=" + cfcd + "&basc=" + basc + "&bascNm=" + bascNm 
			+ "&bascDesc=" + bascDesc + "&bascApplStDt=" + bascApplStDt + "&bascApplClosDt=" + bascApplClosDt + "&bascLstHistYn=" + bascLstHistYn;
			
			
			$.ajax({
				type : "post",
				dataType : "json",
				async : false,
				url : "goCodeDetlPopu.ajax",
				data : parameters,
				success : function(data) {
					$("#popup3 .topBox").html("");
					$("#popup3 .buttonset").html("");
					$("#popup3 #popuDtcd").html("");
					
					if(popKnd == "0"){
						var inner = '';
						inner += '<h3>상세코드 등록</h3>';
						inner += '<a class="close" href="#" onclick="closePopu()">&#10005;</a>';
						$('#popup3 .topBox').append(inner);
						
						inner = "";
						inner += '<button type="button" class="state-highlight" onclick="detlInsert()">저장</button>';
						inner += '<button type="button" class="close" onclick="closePopu()">닫기</button>';
						$("#popup3 .buttonset").append(inner);
						
						inner = "";
						inner += '<tr>';
						inner += '<th>상세코드<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" class="width100" id="dtcd" name="dtcd"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>상세코드명<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" class="width100" id="dtcdNm" name="dtcdNm"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>상세코드 설명</th>';
						inner += '<td><input type="text" class="width100" id="dtcdDesc" name="dtcdDesc"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>적용시작일자<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" size="13" class="dateinput" id="dtcdApplStDt" name="dtcdApplStDt" onkeypress="dateFormat(this)"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>적용종료일자<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" size="13" class="dateinput" id="dtcdApplClosDt" name="dtcdApplClosDt" onkeypress="dateFormat(this)"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>사용여부<span style="color: #fea338;">*</span></th>';
						inner += '<td>';
						inner += '<select id="dtcdLstHistYn" name="dtcdLstHistYn" class="width25">';
						inner += '<option value="Y" selected="true">Y</option>';
						inner += '<option value="N">N</option>';
						inner += '</select>';
						inner += '</td>';
						inner += '</tr>';
						$("#popup3 #popuDtcd").append(inner);
						
						getToday('dtcdApplStDt');
						$('#dtcdApplClosDt').val('9999-12-31');
					}
					
					if(popKnd == "1"){
						var inner = '';
						inner += '<h3>상세코드 수정</h3>';
						inner += '<a class="close" href="#" onclick="closePopu()">&#10005;</a>';
						$('#popup3 .topBox').append(inner);
						
						inner = "";
						inner += '<button type="button" class="state-highlight" onclick="detlUpdate()">수정</button>';
						inner += '<button type="button" class="close" onclick="closePopu()">닫기</button>';
						$("#popup3 .buttonset").append(inner);
						
						inner = "";
						inner += '<tr>';
						inner += '<th>상세코드<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" class="width100" id="dtcd" name="dtcd" value="' + data.popuInfo.dtcd + '" readonly></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>상세코드명<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" class="width100" id="dtcdNm" name="dtcdNm" value="' + data.popuInfo.dtcdNm + '"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>상세코드 설명</th>';
						inner += '<td><input type="text" class="width100" id="dtcdDesc" name="dtcdDesc" value="' + data.popuInfo.dtcdDesc + '"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>적용시작일자<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" size="13" class="dateinput" id="dtcdApplStDt" name="dtcdApplStDt" value="' + data.popuInfo.dtcdApplStDt + '" onkeypress="dateFormat(this)"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>적용종료일자<span style="color: #fea338;">*</span></th>';
						inner += '<td><input type="text" size="13" class="dateinput" id="dtcdApplClosDt" name="dtcdApplClosDt" value="' + data.popuInfo.dtcdApplClosDt + '" onkeypress="dateFormat(this)"></td>';
						inner += '</tr>';
						inner += '<tr>';
						inner += '<th>사용여부<span style="color: #fea338;">*</span></th>';
						inner += '<td>';
						inner += '<select id="dtcdLstHistYn" name="dtcdLstHistYn" class="width25">';
						if(data.popuInfo.dtcdLstHistYn == "Y"){
							inner += '<option value="Y" selected="true">Y</option>';
							inner += '<option value="N">N</option>';			
						} else{
							inner += '<option value="Y">Y</option>';
							inner += '<option value="N" selected="true">N</option>';
						}
						inner += '</select>';
						inner += '</td>';
						inner += '</tr>';
						$("#popup3 #popuDtcd").append(inner);
					}
				},complete : function(data) {
					datepicker();
				}
			});
		}
		
		//세부코드 등록
		function detlInsert(){
			if(reqValCheck('dtcd', '상세코드')) return;
			if(reqValCheck('dtcdNm', '상세코드명')) return;
			
			var cfcd = $("#detlBasc tr").children().eq(5).text();
			
			var basc = $("#detlBasc tr").children().eq(1).text();
			var bascNm = $("#detlBasc tr").children().eq(3).text();
			var bascDesc = $("#detlBasc tr").children().eq(13).text();
			var bascApplStDt = $("#detlBasc tr").children().eq(7).text();
			var bascApplClosDt = $("#detlBasc tr").children().eq(9).text();
			var bascLstHistYn = $("#detlBasc tr").children().eq(11).text();
			
			var parameters = { 
					cfcd			: cfcd,
					basc			: basc,
					bascNm			: bascNm,
					bascDesc		: bascDesc,
					bascApplStDt	: bascApplStDt,
					bascApplClosDt 	: bascApplClosDt,
					bascLstHistYn 	: bascLstHistYn,
					dtcd			: $('#dtcd').val(),
					dtcdNm			: $('#dtcdNm').val(),
					dtcdDesc		: $('#dtcdDesc').val(),
					dtcdApplStDt	: $('#dtcdApplStDt').val(),
					dtcdApplClosDt 	: $('#dtcdApplClosDt').val(),
					dtcdLstHistYn 	: $('#dtcdLstHistYn').val(),
				};
					
			$.ajax({
				type : "post",
				dataType : "json",
				async : false,
				url : "dtcdInsert.ajax",
				data : parameters,
				success : function(data) {
					alert("저장되었습니다.");
					closePopu();
					
					codeMgntSelect();
				},
				complete : function(data) {
				}
			});
		}

		//세부코드 수정 => 적용종료일자 : 현재일자 -1 / 현재사용여부 : N
		function detlUpdate(){
			if(reqValCheck('dtcd', '상세코드')) return;
			if(reqValCheck('dtcdNm', '상세코드명')) return;
			
			var cfcd = $("#detlBasc tr").children().eq(5).text();
			
			var basc = $("#detlBasc tr").children().eq(1).text();
			var bascNm = $("#detlBasc tr").children().eq(3).text();
			var bascDesc = $("#detlBasc tr").children().eq(13).text();
			var bascApplStDt = $("#detlBasc tr").children().eq(7).text();
			var bascApplClosDt = $("#detlBasc tr").children().eq(9).text();
			var bascLstHistYn = $("#detlBasc tr").children().eq(11).text();
			
			var parameters = { 
					detlPk			: $('#detlPk').val(),
					cfcd			: cfcd,
					basc			: basc,
					bascNm			: bascNm,
					bascDesc		: bascDesc,
					bascApplStDt	: bascApplStDt,
					bascApplClosDt 	: bascApplClosDt,
					bascLstHistYn 	: bascLstHistYn,
					dtcd			: $('#dtcd').val(),
					dtcdNm			: $('#dtcdNm').val(),
					dtcdDesc		: $('#dtcdDesc').val(),
					dtcdApplStDt	: $('#dtcdApplStDt').val(),
					dtcdApplClosDt 	: $('#dtcdApplClosDt').val(),
					dtcdLstHistYn 	: $('#dtcdLstHistYn').val(),
				};
					
			$.ajax({
				type : "post",
				dataType : "json",
				async : false,
				url : "dtcdUpdate.ajax",
				data : parameters,
				success : function(data) {
					alert("수정되었습니다.");
					closePopu();

					codeMgntSelect();
				},
				complete : function(data) {
				}
			});
		}
    </script>

</head>

<body>
<input style="display:none;" type="text" id="detlPk" name="detlPk">
<form id="codeMgnt">
    <!-- wrap -->
    <div id="wrap">
        <!-- contents -->
        <div id="contents">
            <!-- section -->
            <div class="section">
                <!-- caption-pnl -->
                <div class="caption-pnl">
                    <h2>코드관리</h2>
                </div>
                <!-- //caption-pnl -->
                <!-- search-pnl -->
                <div class="search-pnl">
                    <div class="buttonset">
                    </div>
                    <table>
                        <colgroup>
                            <col width="120px" />
                            <col width="*" />
                            <col width="120px" />
                            <col width="*" />
                            <col width="120px" />
                            <col width="*" />
                            <col width="120px" />
                            <col width="*" />
                            <col width="200px" />
                        </colgroup>
                        <tr>
                            <th>분류코드</th>
                            <td><input type="text" size="8" id="inputCfcd" name="inputCfcd" value='${inputCfcd}' onKeyDown="enterSerch()"></td>
                            <th>분류코드명</th>
                            <td><input type="text" size="8" id="inputCfcdNm" name="inputCfcdNm" value='${inputCfcdNm}' onKeyDown="enterSerch()"></td>
                            <th>기본코드</th>
                            <td><input type="text" size="8" id="inputBasc" name="inputBasc" value='${inputBasc}' onKeyDown="enterSerch()"></td>
                            <th>기본코드명</th>
                            <td><input type="text" size="8" id="inputBascNm" name="inputBascNm" value='${inputBascNm}' onKeyDown="enterSerch()"></td>
                            <td class="buttonset"><button type="button" onclick="codeMgntSelect()">조회</button>
                            </td>
                        </tr>
                    </table>
                </div>
                <!-- //search-pnl -->

                <!-- colgroup-wrap -->
                <div class="colgroup-wrap">
                    <div class="colgroup-1-3">
                        <div class="caption-pnl">
                            <div class="buttonset">
                                <button type="button" onclick="goCodeClfPopu('0', '')">등록</button>
                            </div>
                        </div>
                        <div class="grid-pnl">
	                        <!-- table-pnl -->
	                        <div class="table-pnl" style="overflow-x:hidden; overflow-y:auto; height:300px;">
	                            <!-- table -->
	                            <table class="vtable bordertd">
	                                <colgroup>
	                                    <col width="120px">
	                                    <col width="*">
	                                </colgroup>
	                                <thead>
	                                    <tr>
	                                        <th>분류코드</th>
	                                        <th>분류코드명</th>
	                                    </tr>
	                                </thead>
	                                <tbody id="cfcdTable">
	                                <c:forEach var="codeMgnt" items="${codeMgntCfcdLst}">
							            <tr>
							                <td class="text-c" onclick="goCodeClfPopu('1', '${codeMgnt.cfcd}')">${codeMgnt.cfcd}</td>
							                <td onclick="cfcdToBascSelect('${codeMgnt.cfcd}')">${codeMgnt.cfcdNm}</td>
							            </tr>
						       		</c:forEach>
	                                </tbody>
	                            </table>
	                            <!-- //table -->
	                        </div>
	                        <!-- //table-pnl -->
                        </div>
                    </div>
                    <div class="colgroup-1-3">
                        <div class="caption-pnl">
                            <div class="buttonset">
                                <button type="button" onclick="goCodeBascPopu('0', '')">등록</button>
                            </div>
                        </div>
                        <div class="grid-pnl">
	                        <!-- table-pnl -->
	                        <div class="table-pnl" style="overflow-x:hidden; overflow-y:auto; height:300px;">
	                            <!-- table -->
	                            <table class="vtable bordertd">
	                                <colgroup>
	                                    <col width="120px">
	                                    <col width="*">
	                                </colgroup>
	                                <thead>
	                                    <tr>
	                                        <th>기본코드</th>
	                                        <th>기본코드명</th>
	                                    </tr>
	                                </thead>
	                                <tbody id="bascTable">
	                                <c:forEach var="codeMgnt" items="${codeMgntBascLst}">
							            <tr>
							                <td class="text-c" onclick="goCodeBascPopu('1', '${codeMgnt.detlPk}')">${codeMgnt.basc}</td>
							                <td onclick="bascToDtcdSelect('${codeMgnt.detlPk}')">${codeMgnt.bascNm}</td>
							            </tr>
						       		</c:forEach>
	                                </tbody>
	                            </table>
	                            <!-- //table -->
	                        </div>
	                        <!-- //table-pnl -->
                        </div>
                    </div>
                    <div class="colgroup-1-3">
                        <div class="caption-pnl">
                            <div class="buttonset">
                                <button type="button" onclick="goCodeDetlPopu('0', '')">등록</button>
                            </div>
                        </div>
                        <div class="grid-pnl">
	                        <!-- table-pnl -->
	                        <div class="table-pnl" style="overflow-x:hidden; overflow-y:auto; height:300px;">
	                            <!-- table -->
	                            <table class="vtable bordertd">
	                                <colgroup>
	                                    <col width="120px">
	                                    <col width="*">
	                                </colgroup>
	                                <thead>
	                                    <tr>
	                                        <th>상세코드</th>
	                                        <th>상세코드명</th>
	                                    </tr>
	                                </thead>
	                                <tbody id="dtcdTable">
	                                <c:forEach var="codeMgnt" items="${codeMgntDtcdLst}">
							            <tr>
							                <td class="text-c" onclick="goCodeDetlPopu(1, ${codeMgnt.detlPk})">${codeMgnt.dtcd}</td>
							                <td>${codeMgnt.dtcdNm}</td>
							            </tr>
					       			</c:forEach>
	                                </tbody>
	                            </table>
	                            <!-- //table -->
	                        </div>
	                        <!-- //table-pnl -->
                        </div>
                    </div>
                </div>
                <!-- // colgroup-wrap -->

                <div class="colgroup-wrap">
                    <!-- table-pnl -->
                    <div class="table-pnl">
                        <!-- table -->
                        <table>
                            <colgroup>
                                <col width="11%">
                                <col width="22%">
                                <col width="11%">
                                <col width="22%">
                                <col width="11%">
                                <col width="22%">
                            </colgroup>
                            <tbody id="detlCfcd">
                             <tr>
                                 <th>분류코드</th>
                                 <td>${_cfcd}</td>
                                 <th>분류코드명</th>
                                 <td>${_cfcdNm}</td>
                                 <th>분류코드설명</th>
                                 <td>${_cfcdDesc}</td>
                             </tr>
                            </tbody>
                        </table>
                        <!-- //table -->
                    </div>
                    <!-- //table-pnl -->
              	</div>
                <!--// colgroup-wrap -->
                
                <div class="colgroup-wrap">
                    <!-- table-pnl -->
                    <div class="table-pnl">
                        <!-- table -->
                        <table>
                            <colgroup>
                                <col width="11%">
                                <col width="22%">
                                <col width="11%">
                                <col width="22%">
                                <col width="11%">
                                <col width="22%">
                            </colgroup>
                            <tbody id="detlBasc">
                             <tr>
                                 <th>기본코드</th>
                                 <td>${_basc}</td>
                                 <th>기본코드명</th>
                                 <td>${_bascNm}</td>
                                 <th>상위분류코드</th>
                                 <td>${_cfcd}</td>
                             </tr>
                             <tr>
                                 <th>적용시작일자</th>
                                 <td>${_bascApplStDt}</td>
                                 <th>적용종료일자</th>
                                 <td>${_bascApplClosDt}</td>
                                 <th>현재사용여부</th>
                                 <td>${_bascLstHistYn}</td>
                             </tr>
                             <tr>
                                 <th>기본코드설명</th>
                                 <td colspan="5">${_bascDesc}</td>
                             </tr>
                            </tbody>
                        </table>
                        <!-- //table -->
                    </div>
                    <!-- //table-pnl -->
                </div>
                <!--// colgroup-wrap -->
                <div class="colgroup-wrap">
                    <!-- table-pnl -->
                    <div class="table-pnl">
                        <!-- table -->
                        <table>
                            <colgroup>
                                <col width="11%">
                                <col width="22%">
                                <col width="11%">
                                <col width="22%">
                                <col width="11%">
                                <col width="22%">
                            </colgroup>
                            <tbody id="detlDtcd">
                             <tr>
                                 <th>상세코드</th>
                                 <td>${_dtcd}</td>
                                 <th>상세코드명</th>
                                 <td>${_dtcdNm}</td>
                                 <th>상위분류코드</th>
                                 <td></td>
                             </tr>
                             <tr>
                                 <th>적용시작일자</th>
                                 <td>${_dtcdApplStDt}</td>
                                 <th>적용종료일자</th>
                                 <td>${_dtcdApplClosDt}</td>
                                 <th>현재사용여부</th>
                                 <td>${_dtcdLstHistYn}</td>
                             </tr>
                             <tr>
                                 <th>상세코드설명</th>
                                 <td colspan="5">${_dtcdDesc}</td>
                             </tr>
                            </tbody>
                        </table>
                        <!-- //table -->
                    </div>
                    <!-- //table-pnl -->
                </div>
                <!--// colgroup-wrap -->
        </div>
        <!-- //contents -->
    </div>
    <!-- //wrap -->
</form>

    <div id="popup1" class="layerBox" style="display:none;">
		<div class="layer">
			<div class="topBox">
			</div>
			<div class="contBox">
				<div class="table-pnl">
					<table>
                        <colgroup>
                            <col width="160px">
                            <col width="*">
                        </colgroup>
                        <tbody id="popuCfcd">
                        </tbody>
                    </table>
				</div>
				<!-- footer -->
				<div class="footer">
					<div class="buttonset">
					</div>
				</div>
				<!-- //footer -->
			</div>
			<!-- //contBox -->
		</div>
	<div class="fade"></div>
	</div>
    <div id="popup2" class="layerBox" style="display:none;">
		<div class="layer">
			<div class="topBox">
			</div>
			<div class="contBox">
				<div class="table-pnl">
					<table>
                        <colgroup>
                            <col width="160px">
                            <col width="*">
                        </colgroup>
                        <tbody id="popuBasc">
                        </tbody>
                    </table>
				</div>
				<!-- footer -->
				<div class="footer">
					<div class="buttonset">
					</div>
				</div>
				<!-- //footer -->
			</div>
			<!-- //contBox -->
		</div>
	<div class="fade"></div>
	</div>
    <div id="popup3" class="layerBox" style="display:none;">
		<div class="layer">
			<div class="topBox">
			</div>
			<div class="contBox">
				<div class="table-pnl">
					<table>
                        <colgroup>
                            <col width="160px">
                            <col width="*">
                        </colgroup>
                        <tbody id="popuDtcd">
                        </tbody>
                    </table>
				</div>
				<!-- footer -->
				<div class="footer">
					<div class="buttonset">
					</div>
				</div>
				<!-- //footer -->
			</div>
			<!-- //contBox -->
		</div>
		<div class="fade"></div>
	</div>
</body>

</html>